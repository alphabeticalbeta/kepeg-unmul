<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Conditional Fields</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto bg-white p-6 rounded-lg shadow-md">
        <h2 class="text-2xl font-semibold mb-6">Test Conditional Fields</h2>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <!-- Left Column -->
            <div>
                <h3 class="text-lg font-semibold mb-4">Informasi Dasar</h3>

                <div class="mb-4">
                    <label for="jenis_pegawai" class="block text-sm font-medium text-gray-700 mb-2">Jenis Pegawai</label>
                    <select id="jenis_pegawai" class="w-full border border-gray-300 rounded-md px-3 py-2">
                        <option value="">Pilih Jenis Pegawai</option>
                        <option value="Dosen">Dosen</option>
                        <option value="Tenaga Kependidikan">Tenaga Kependidikan</option>
                    </select>
                </div>

                <div id="field_nuptk" class="mb-4 hidden">
                    <label for="nuptk" class="block text-sm font-medium text-gray-700 mb-2">NUPTK</label>
                    <input type="text" id="nuptk" class="w-full border border-gray-300 rounded-md px-3 py-2" placeholder="16 Karakter Numerik">
                </div>
            </div>

            <!-- Right Column -->
            <div>
                <h3 class="text-lg font-semibold mb-4">Informasi Jabatan</h3>

                <div class="mb-4">
                    <label for="jabatan_terakhir_id" class="block text-sm font-medium text-gray-700 mb-2">
                        Jabatan Terakhir <span id="jenis_jabatan_display" class="text-indigo-600"></span>
                    </label>
                    <select id="jabatan_terakhir_id" class="w-full border border-gray-300 rounded-md px-3 py-2">
                        <option value="">Pilih Jabatan</option>
                        <!-- Dosen Options -->
                        <option value="1" data-jenis-pegawai="Dosen" data-jenis-jabatan="Dosen Fungsional">Asisten Ahli</option>
                        <option value="2" data-jenis-pegawai="Dosen" data-jenis-jabatan="Dosen Fungsional">Lektor</option>
                        <option value="3" data-jenis-pegawai="Dosen" data-jenis-jabatan="Dosen Fungsi Tambahan">Kepala Program Studi</option>
                        <option value="4" data-jenis-pegawai="Dosen" data-jenis-jabatan="Dosen Fungsi Tambahan">Dekan</option>
                        <!-- Tenaga Kependidikan Options -->
                        <option value="5" data-jenis-pegawai="Tenaga Kependidikan" data-jenis-jabatan="Tenaga Kependidikan Struktural">Kepala Bagian</option>
                        <option value="6" data-jenis-pegawai="Tenaga Kependidikan" data-jenis-jabatan="Tenaga Kependidikan Fungsional Tertentu">Pustakawan</option>
                        <option value="7" data-jenis-pegawai="Tenaga Kependidikan" data-jenis-jabatan="Tenaga Kependidikan Fungsional Umum">Staff Administrasi</option>
                    </select>
                </div>

                <div id="field_nilai_konversi" class="mb-4 hidden">
                    <label for="nilai_konversi" class="block text-sm font-medium text-gray-700 mb-2">Nilai Konversi</label>
                    <input type="number" id="nilai_konversi" step="any" class="w-full border border-gray-300 rounded-md px-3 py-2" placeholder="Contoh: 112.50">
                </div>

                <div id="field_pak_konversi" class="mb-4 hidden">
                    <label for="pak_konversi" class="block text-sm font-medium text-gray-700 mb-2">PAK Konversi</label>
                    <input type="file" id="pak_konversi" class="w-full border border-gray-300 rounded-md px-3 py-2">
                </div>

                <div id="dosen_fields_wrapper" class="hidden">
                    <h4 class="text-md font-semibold mb-2">Informasi Spesifik Dosen</h4>
                    <div class="mb-4">
                        <label for="mata_kuliah_diampu" class="block text-sm font-medium text-gray-700 mb-2">Mata Kuliah yang diampu</label>
                        <textarea id="mata_kuliah_diampu" rows="3" class="w-full border border-gray-300 rounded-md px-3 py-2"></textarea>
                    </div>
                </div>
            </div>
        </div>

        <!-- Debug Info -->
        <div class="mt-8 p-4 bg-gray-50 rounded-md">
            <h4 class="font-semibold mb-2">Debug Info:</h4>
            <div id="debug_info" class="text-sm text-gray-600"></div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // --- Selektor Elemen ---
            const jenisPegawaiSelect = document.getElementById('jenis_pegawai');
            const jabatanSelect = document.getElementById('jabatan_terakhir_id');
            const jenisJabatanDisplay = document.getElementById('jenis_jabatan_display');
            const nuptkField = document.getElementById('field_nuptk');
            const dosenFieldsWrapper = document.getElementById('dosen_fields_wrapper');
            const skKonversiField = document.getElementById('field_pak_konversi');
            const nilaiKonversiField = document.getElementById('field_nilai_konversi');
            const debugInfo = document.getElementById('debug_info');

            // --- Fungsi Inti ---

            function filterJabatan() {
                const selectedJenisPegawai = jenisPegawaiSelect.value;
                let hasVisibleOptions = false;

                // Iterasi semua opsi jabatan
                for (const option of jabatanSelect.options) {
                    if (option.value === "") { // Selalu tampilkan opsi "Pilih Jabatan"
                        option.style.display = "block";
                        continue;
                    }

                    const optionJenisPegawai = option.dataset.jenisPegawai;

                    // Tampilkan jika jenis pegawai cocok atau jika tidak ada jenis pegawai yang dipilih
                    if (!selectedJenisPegawai || optionJenisPegawai === selectedJenisPegawai) {
                        option.style.display = "block";
                        hasVisibleOptions = true;
                    } else {
                        option.style.display = "none";
                    }
                }

                // Jika jabatan yang terpilih saat ini disembunyikan, reset pilihan
                if (jabatanSelect.options[jabatanSelect.selectedIndex]?.style.display === 'none') {
                    jabatanSelect.value = "";
                }
            }

            function updateJenisJabatanLabel() {
                const selectedOption = jabatanSelect.options[jabatanSelect.selectedIndex];
                if (selectedOption && selectedOption.value) {
                    const jenisJabatan = selectedOption.dataset.jenisJabatan;
                    jenisJabatanDisplay.textContent = `(${jenisJabatan})`;
                } else {
                    jenisJabatanDisplay.textContent = ''; // Kosongkan jika tidak ada yang dipilih
                }
            }

            function toggleConditionalFields() {
                const selectedJenisPegawai = jenisPegawaiSelect.value;
                const selectedJabatanOption = jabatanSelect.options[jabatanSelect.selectedIndex];
                const selectedJenisJabatan = selectedJabatanOption ? selectedJabatanOption.dataset.jenisJabatan : '';

                // Debug info
                debugInfo.innerHTML = `
                    <strong>Jenis Pegawai:</strong> "${selectedJenisPegawai}"<br>
                    <strong>Jenis Jabatan:</strong> "${selectedJenisJabatan}"<br>
                `;

                // --- KONDISI UNTUK NUPTK, NILAI KONVERSI, PAK KONVERSI ---
                // Tampilkan jika:
                // 1. Jenis Pegawai = Dosen AND Jenis Jabatan = Dosen Fungsional OR Dosen Fungsi Tambahan
                // 2. OR Jenis Pegawai = Tenaga Kependidikan AND Jenis Jabatan = Tenaga Kependidikan Fungsional Tertentu
                const showNuptkAndKonversiFields = (
                    (selectedJenisPegawai === 'Dosen' && ['Dosen Fungsional', 'Dosen Fungsi Tambahan'].includes(selectedJenisJabatan)) ||
                    (selectedJenisPegawai === 'Tenaga Kependidikan' && selectedJenisJabatan === 'Tenaga Kependidikan Fungsional Tertentu')
                );

                debugInfo.innerHTML += `<strong>Show NUPTK & Konversi Fields:</strong> ${showNuptkAndKonversiFields}<br>`;

                // Toggle visibility untuk NUPTK, Nilai Konversi, PAK Konversi
                nuptkField.classList.toggle('hidden', !showNuptkAndKonversiFields);
                nilaiKonversiField.classList.toggle('hidden', !showNuptkAndKonversiFields);
                skKonversiField.classList.toggle('hidden', !showNuptkAndKonversiFields);

                // --- KONDISI UNTUK FIELD SPESIFIK DOSEN LAINNYA ---
                // Field dosen lainnya (mata kuliah, ranting ilmu, sinta) tetap tampil untuk semua jenis dosen
                const isDosen = selectedJenisPegawai === 'Dosen';
                dosenFieldsWrapper.classList.toggle('hidden', !isDosen);

                debugInfo.innerHTML += `<strong>Show Dosen Fields:</strong> ${isDosen}`;
            }

            // --- Panggilan Awal saat Halaman Dimuat ---
            toggleConditionalFields();
            filterJabatan();
            updateJenisJabatanLabel();

            // --- Event Listeners ---
            jenisPegawaiSelect.addEventListener('change', function() {
                toggleConditionalFields();
                filterJabatan();
                updateJenisJabatanLabel();
            });

            jabatanSelect.addEventListener('change', function() {
                updateJenisJabatanLabel();
                toggleConditionalFields();
            });
        });
    </script>
</body>
</html>
